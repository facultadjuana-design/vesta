<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito - Vesta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
  <style>
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-vintage">
  <div class="container">
    <a class="navbar-brand" href="index.html">Vesta</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <form class="d-flex me-3" role="search" id="form-busqueda">
        <input class="form-control me-2" type="search" placeholder="Buscar prenda" aria-label="Buscar" id="input-busqueda">
        <button class="btn btn-outline-light" type="submit">Buscar</button>
      </form>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link btn btn-outline-light me-2" href="catalogo.html">CatÃ¡logo</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-outline-light me-2" href="login.html">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-outline-light me-2" href="mispedidos.html">Mis pedidos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-outline-light" href="carrito.html">Carrito ðŸ›’</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Carrito -->
<div class="container mt-5">
  <h2 class="mb-4 text-center" style="font-family: 'Playfair Display', serif;">Tu Carrito ðŸ›’</h2>
  <div id="lista-carrito"></div>
  <p class="fw-bold mt-3 text-end">Total: $<span id="carrito-total">0</span></p>
  <div class="d-flex gap-2 mt-3">
    <button class="btn btn-danger w-50" id="vaciar-carrito">Vaciar carrito</button>
    <button class="btn btn-success w-50" id="btn-comprar">Comprar</button>
  </div>
</div>

<footer class="bg-vintage text-light text-center py-3 mt-5">
  &copy; 2025 Vesta. Todos los derechos reservados.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Obtener elementos
  const listaCarritoDiv = document.getElementById('lista-carrito');
  const carritoTotalSpan = document.getElementById('carrito-total');
  const vaciarCarritoBtn = document.getElementById('vaciar-carrito');
  const btnComprar = document.getElementById('btn-comprar');

  // Cargar carrito desde localStorage y normalizar precios (por si existen entradas antiguas con formato "20.000")
  let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
  let _normalized = false;
  carrito = carrito.map(item => {
    const precioNum = Number(String(item.precio).replace(/\./g, '').replace(/,/g, '')) || 0;
    if (precioNum !== item.precio) _normalized = true;
    return { ...item, precio: precioNum };
  });
  if (_normalized) localStorage.setItem('carrito', JSON.stringify(carrito));

  function mostrarCarrito() {
    listaCarritoDiv.innerHTML = '';
    let total = 0;

    if(carrito.length === 0){
      listaCarritoDiv.innerHTML = '<p class="text-center">Tu carrito estÃ¡ vacÃ­o</p>';
    } else {
      carrito.forEach((item, index) => {
        const precioNum = Number(item.precio) || 0;
        total += precioNum;
        const imagenHtml = item.imagen ? `<img src="img/${item.imagen}" alt="${item.nombre}" class="cart-thumb">` : '';
        listaCarritoDiv.innerHTML += `
          <div class="card mb-3 vintage-card p-3 hover-card">
            <div class="d-flex align-items-center">
              ${imagenHtml}
              <div>
                <h5>${item.nombre}</h5>
                <p>$${precioNum.toLocaleString('es-AR')}</p>
                <button class="btn btn-outline-danger btn-sm mt-2" onclick="eliminarProducto(${index})">Eliminar</button>
              </div>
            </div>
          </div>
        `;
      });
    }

    carritoTotalSpan.textContent = total.toLocaleString('es-AR');
  }

  function eliminarProducto(index) {
    carrito.splice(index, 1);
    localStorage.setItem('carrito', JSON.stringify(carrito));
    mostrarCarrito();
  }

  vaciarCarritoBtn.addEventListener('click', () => {
    carrito = [];
    localStorage.setItem('carrito', JSON.stringify(carrito));
    mostrarCarrito();
  });

  btnComprar.addEventListener('click', () => {
    if(carrito.length === 0){
      alert('No hay productos en el carrito.');
      return;
    }
    alert('Gracias por tu compra!');
    carrito = [];
    localStorage.setItem('carrito', JSON.stringify(carrito));
    mostrarCarrito();
  });

  // Buscador
  document.getElementById('form-busqueda').addEventListener('submit', function(e){
    e.preventDefault();
    const query = document.getElementById('input-busqueda').value.toLowerCase();
    localStorage.setItem('busqueda', query);
    window.location.href = 'index.html';
  });

  // Mostrar carrito al cargar
  mostrarCarrito();
</script>

</body>
</html>

